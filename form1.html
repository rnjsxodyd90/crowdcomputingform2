<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qualifying Quiz</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f0f2f5;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px 12px 0 0;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 15px;
        }

        .header p {
            font-size: 14px;
            line-height: 1.6;
            opacity: 0.95;
        }

        .form-section {
            background: white;
            padding: 0;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .question {
            padding: 25px 30px;
            border-bottom: 1px solid #eee;
        }

        .question:last-of-type {
            border-bottom: none;
        }

        .question-label {
            font-size: 15px;
            color: #333;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .question-label .required {
            color: #e53935;
            margin-left: 4px;
        }

        .text-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 15px;
            transition: border-color 0.2s;
        }

        .text-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option-label {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            color: #444;
        }

        .option-label:hover {
            background: #f8f9ff;
            border-color: #667eea;
        }

        .option-label input {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .option-label.selected {
            background: #f0f3ff;
            border-color: #667eea;
        }

        .submit-section {
            padding: 25px 30px;
            background: #f9f9f9;
            border-radius: 0 0 12px 12px;
        }

        .submit-btn {
            width: 100%;
            padding: 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .submit-btn:hover {
            background: #5a6fd6;
        }

        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .error-msg {
            color: #e53935;
            font-size: 13px;
            margin-top: 8px;
            display: none;
        }

        .question.error .error-msg {
            display: block;
        }

        .question.error .text-input,
        .question.error .options {
            border-color: #e53935;
        }

        .message-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 60px 40px;
            text-align: center;
        }

        .message-container .icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .message-container h2 {
            color: #333;
            margin-bottom: 15px;
        }

        .message-container p {
            color: #666;
            line-height: 1.6;
        }

        .message-container.failed {
            border-top: 4px solid #e53935;
        }

        .message-container.failed .icon {
            color: #e53935;
        }
    </style>
</head>
<body>
    <div class="container" id="app">
        <!-- Content loaded dynamically -->
    </div>

    <script>
        // ============================================
        // CONFIGURATION - EDIT THIS SECTION
        // ============================================
        const CONFIG = {
            // Where to redirect on success (Form 2 URL)
            form2Url: "index.html",

            // Quiz title and description
            title: "AI Literacy Quiz",
            description: "Please answer the following questions about AI. If you get 6 or more correct, you will proceed to Form 2. If we think your answers on Form 2 are reasonable, you will receive a bonus payment on top of your base pay.",

            // Minimum correct answers to pass
            passingScore: 6,

            // Your questions - AI Literacy Quiz (AILQ-LL)
            questions: [
                {
                    id: 1,
                    question: "What is Generative AI (GenAI)?",
                    type: "multiple-choice",
                    options: [
                        "A specific programming language that is used to create learning materials",
                        "A robotic system that can analyse and teach languages",
                        "A type of AI technology that automatically generates content in response to prompts",
                        "A database of intelligent machines that perform human tasks"
                    ],
                    correct: "A type of AI technology that automatically generates content in response to prompts"
                },
                {
                    id: 2,
                    question: "What is Machine Learning (ML)?",
                    type: "multiple-choice",
                    options: [
                        "A type of AI that is used in robotics",
                        "A subset of AI that allows machines to learn from data without explicit programming",
                        "A type of AI that is used in computers",
                        "A technique that is used to understand and interpret human language"
                    ],
                    correct: "A subset of AI that allows machines to learn from data without explicit programming"
                },
                {
                    id: 3,
                    question: "What is Natural Language Processing (NLP)?",
                    type: "multiple-choice",
                    options: [
                        "A type of AI that is used for image recognition and creation",
                        "A programming language that is used for computer hardware and software",
                        "A method for processing and memorising vocabulary",
                        "A subfield of AI that enables computers to understand and generate human language"
                    ],
                    correct: "A subfield of AI that enables computers to understand and generate human language"
                },
                {
                    id: 4,
                    question: "What is the role of data in AI?",
                    type: "multiple-choice",
                    options: [
                        "Creating hardware",
                        "Training AI models",
                        "Increasing storage space",
                        "Reducing unsupervised learning"
                    ],
                    correct: "Training AI models"
                },
                {
                    id: 5,
                    question: "What is a potential ethical concern regarding the use of AI?",
                    type: "multiple-choice",
                    options: [
                        "Bias in AI-generated content",
                        "Lack of personalised learning experiences",
                        "Insufficient number of AI tools",
                        "Inefficiency in grading student work"
                    ],
                    correct: "Bias in AI-generated content"
                },
                {
                    id: 6,
                    question: "Which of the following does NOT need to be asked when evaluating an AI tool?",
                    type: "multiple-choice",
                    options: [
                        "Purpose",
                        "Accuracy",
                        "Privacy",
                        "Preservation"
                    ],
                    correct: "Preservation"
                },
                {
                    id: 7,
                    question: "Which of the following is NOT a common application of AI in education?",
                    type: "multiple-choice",
                    options: [
                        "Virtual reality",
                        "Physical textbook",
                        "Automated transcription",
                        "Quiz generator"
                    ],
                    correct: "Physical textbook"
                },
                {
                    id: 8,
                    question: "Which of the following is an example of an AI chatbot used in language learning?",
                    type: "multiple-choice",
                    options: [
                        "A program that can provide interactive conversations and feedback",
                        "A program that can play educational games",
                        "A program that can track student progress and generate reports",
                        "A program that can create a social media platform"
                    ],
                    correct: "A program that can provide interactive conversations and feedback"
                },
                {
                    id: 9,
                    question: "Which AI tool can be used for automated language translation?",
                    type: "multiple-choice",
                    options: [
                        "Duolingo",
                        "Canva",
                        "Google Translate",
                        "Education Copilot"
                    ],
                    correct: "Google Translate"
                },
                {
                    id: 10,
                    question: "Which of the following is NOT a key element of AI literacy?",
                    type: "multiple-choice",
                    options: [
                        "How to use AI critically",
                        "How to use AI effectively",
                        "How to use AI ethically",
                        "How to use AI secretly"
                    ],
                    correct: "How to use AI secretly"
                }
            ]
        };
        // ============================================
        // END CONFIGURATION
        // ============================================

        const STORAGE_KEY = 'qualifying_quiz_attempted';
        const app = document.getElementById('app');

        // Get Prolific parameters from URL
        function getProlificParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                visitorId: params.get('PROLIFIC_PID') || '',
                studyId: params.get('STUDY_ID') || '',
                sessionId: params.get('SESSION_ID') || ''
            };
        }

        // Build URL with Prolific parameters
        function buildForm2Url() {
            const prolific = getProlificParams();
            const params = new URLSearchParams();

            if (prolific.visitorId) params.set('PROLIFIC_PID', prolific.visitorId);
            if (prolific.studyId) params.set('STUDY_ID', prolific.studyId);
            if (prolific.sessionId) params.set('SESSION_ID', prolific.sessionId);

            const queryString = params.toString();
            return queryString ? `${CONFIG.form2Url}?${queryString}` : CONFIG.form2Url;
        }

        // Check if user has already attempted
        function hasAttempted() {
            return localStorage.getItem(STORAGE_KEY) !== null;
        }

        // Mark as attempted
        function markAttempted(passed, score) {
            const data = {
                attempted: true,
                passed: passed,
                score: score,
                total: CONFIG.questions.length,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        // Render the quiz form
        function renderQuiz() {
            let questionsHtml = CONFIG.questions.map((q, idx) => {
                let inputHtml = '';

                if (q.type === 'multiple-choice') {
                    inputHtml = `<div class="options">
                        ${q.options.map(opt => `
                            <label class="option-label">
                                <input type="radio" name="q${q.id}" value="${opt}">
                                <span>${opt}</span>
                            </label>
                        `).join('')}
                    </div>`;
                } else if (q.type === 'true-false') {
                    inputHtml = `<div class="options">
                        <label class="option-label">
                            <input type="radio" name="q${q.id}" value="True">
                            <span>True</span>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="q${q.id}" value="False">
                            <span>False</span>
                        </label>
                    </div>`;
                } else if (q.type === 'text') {
                    inputHtml = `<input type="text" class="text-input" name="q${q.id}" placeholder="Type your answer">`;
                }

                return `
                    <div class="question" data-question="${q.id}">
                        <div class="question-label">
                            ${idx + 1}. ${q.question}
                            <span class="required">*</span>
                        </div>
                        ${inputHtml}
                        <div class="error-msg">Please answer this question</div>
                    </div>
                `;
            }).join('');

            app.innerHTML = `
                <div class="header">
                    <h1>${CONFIG.title}</h1>
                    <p>${CONFIG.description}</p>
                </div>

                <div class="form-section">
                    ${questionsHtml}
                    <div class="submit-section">
                        <button class="submit-btn" id="submitBtn">Submit</button>
                    </div>
                </div>
            `;

            setupFormListeners();
        }

        // Setup form event listeners
        function setupFormListeners() {
            const submitBtn = document.getElementById('submitBtn');

            // Update selected styling on input change
            document.querySelectorAll('input[type="radio"]').forEach(input => {
                input.addEventListener('change', () => {
                    const optionLabels = input.closest('.options').querySelectorAll('.option-label');
                    optionLabels.forEach(label => {
                        const inp = label.querySelector('input');
                        label.classList.toggle('selected', inp.checked);
                    });
                });
            });

            // Submit handler
            submitBtn.addEventListener('click', () => {
                if (!validateForm()) {
                    return;
                }

                submitBtn.disabled = true;
                submitBtn.textContent = 'Checking...';

                const score = checkAnswers();
                const passed = score >= CONFIG.passingScore;

                if (passed) {
                    markAttempted(true, score);
                    // Redirect to Form 2 with Prolific params
                    window.location.href = buildForm2Url();
                } else {
                    markAttempted(false, score);
                    renderFailed(score);
                }
            });
        }

        // Validate all questions are answered
        function validateForm() {
            let valid = true;

            CONFIG.questions.forEach(q => {
                const questionDiv = document.querySelector(`.question[data-question="${q.id}"]`);
                let hasAnswer = false;

                if (q.type === 'text') {
                    const input = document.querySelector(`input[name="q${q.id}"]`);
                    hasAnswer = input && input.value.trim() !== '';
                } else {
                    hasAnswer = document.querySelector(`input[name="q${q.id}"]:checked`) !== null;
                }

                if (!hasAnswer) {
                    questionDiv.classList.add('error');
                    valid = false;
                } else {
                    questionDiv.classList.remove('error');
                }
            });

            if (!valid) {
                const firstError = document.querySelector('.question.error');
                if (firstError) {
                    firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }

            return valid;
        }

        // Count correct answers and return the score
        function checkAnswers() {
            let correctCount = 0;

            for (const q of CONFIG.questions) {
                let userAnswer = '';
                let isCorrect = false;

                if (q.type === 'text') {
                    const input = document.querySelector(`input[name="q${q.id}"]`);
                    userAnswer = input ? input.value.trim().toLowerCase() : '';
                    // Case-insensitive comparison for text
                    isCorrect = userAnswer === q.correct.toLowerCase();
                } else {
                    const checked = document.querySelector(`input[name="q${q.id}"]:checked`);
                    userAnswer = checked ? checked.value : '';
                    isCorrect = userAnswer === q.correct;
                }

                if (isCorrect) {
                    correctCount++;
                }
            }
            return correctCount;
        }

        // Render failed message
        function renderFailed(score) {
            app.innerHTML = `
                <div class="message-container failed">
                    <div class="icon">&#10006;</div>
                    <h2>Quiz Not Passed</h2>
                    <p>Your score: <strong>${score}/${CONFIG.questions.length}</strong></p>
                    <p>You needed at least ${CONFIG.passingScore} correct answers to pass.</p>
                    <p style="margin-top: 15px; color: #888;">You cannot retake this quiz.</p>
                </div>
            `;
        }

        // Render already attempted message
        function renderAlreadyAttempted() {
            const data = JSON.parse(localStorage.getItem(STORAGE_KEY));

            if (data.passed) {
                // If they passed before, redirect them to Form 2 with Prolific params
                window.location.href = buildForm2Url();
                return;
            }

            app.innerHTML = `
                <div class="message-container failed">
                    <div class="icon">&#128683;</div>
                    <h2>Already Attempted</h2>
                    <p>You have already taken this quiz.</p>
                    <p>Your score: <strong>${data.score}/${data.total}</strong> (needed ${CONFIG.passingScore} to pass)</p>
                    <p style="margin-top: 15px; color: #888;">
                        Attempted on ${new Date(data.timestamp).toLocaleDateString()}
                    </p>
                </div>
            `;
        }

        // Initialize
        function init() {
            if (hasAttempted()) {
                renderAlreadyAttempted();
                return;
            }

            renderQuiz();
        }

        init();
    </script>
</body>
</html>
